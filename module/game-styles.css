
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* 根字体大小响应式设置 */
:root {
    font-size: 16px;
}

@media (max-width: 768px) {
    :root {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    :root {
        font-size: 12px;
    }
}

body {
    font-family: "Microsoft YaHei", "SimSun", serif;
    background: #f5f5f5;
    background-image: 
        repeating-linear-gradient(
            45deg,
            transparent,
            transparent 10px,
            rgba(0,0,0,.03) 10px,
            rgba(0,0,0,.03) 20px
        );
    margin: 0;  /* 确保body没有margin */
    padding: 0;  /* 确保body没有padding */
}

.container {
    width: 100%;
    max-width: 100%;  /* 移除宽度限制 */
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* 视窗包装器 */
.viewport-wrapper {
    width: 100%;
    max-width: 100%;  /* 使用全屏宽度减去左右边距 */
    margin: 0 auto;
    position: relative;
}

/* 视窗样式 */
.viewport {
    width: 100%;
    aspect-ratio: 1.46;
    background: #fff;
    border: 3px solid #2c2c2c;
    box-shadow: 0 0 30px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
    background-image: 
        radial-gradient(circle at 20% 80%, rgba(0,0,0,0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(0,0,0,0.05) 0%, transparent 50%);
    box-sizing: border-box;
}

/* 场景容器 */
.scene {
    position: absolute;
    width: 100%;
    height: 100%;
    display: none;
    background: #f8f8f8;
}

.scene.active {
    display: block;
}

/* 地图场景 */
#map-scene {
    /* background-image将通过JS动态设置 */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: #e8e8e8;
}

/* 各个场景的背景图片都将通过JS动态设置 */
#yanwuchang-scene,
#cangjingge-scene,
#huofang-scene,
#houshan-scene,
#yishiting-scene,
#tiejiangpu-scene,
#nandizi-scene,
#nvdizi-scene,
#shanmen-scene,
#gongtian-scene,
#danfang-scene {
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: #f8f8f8;
}


/* 状态显示 - 响应式改进 */
.status-display {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    /* 高度 ≈ main-viewport 宽度的 5%（viewport 宽高比≈1.46 => 0.05*1.46 ≈ 7.3% 高度） */
    height: clamp(24px, 7.3%, 56px);
    background: rgba(0, 0, 0, 0.7);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: clamp(8px, 2vw, 20px);
    padding: 0 clamp(10px, 2vw, 20px);
    font-size: clamp(0.8rem, 1.6vw, 1.2rem);
    text-shadow: none;
    border-radius: 0;
    box-shadow: none;
    z-index: 20;
}

/* 状态栏内部布局与分隔线 */
.status-display > div {
    display: flex;
    align-items: center;
}
.status-display .date-display { flex: 0 0 auto; }
.status-display .mood-display { flex: 1 1 auto; min-width: clamp(140px, 28vw, 360px); }
.status-display .action-points-display { flex: 0 0 auto; }
.status-display > div:not(:last-child) {
    position: relative;
    padding-right: clamp(10px, 2vw, 20px);
    margin-right: clamp(10px, 2vw, 20px);
}
.status-display > div:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 1px;
    height: 60%;
    background: rgba(255,255,255,0.35);
}

.date-display {
    font-size: clamp(0.95rem, 2vw, 1.5rem);
    font-weight: bold;
    margin: 0;
}

.mood-display,
.action-points-display {
    font-size: inherit;
    font-weight: bold;
    margin: 0;
}

/* 体力进度槽 */
.mood-display { gap: clamp(6px, 1.2vw, 12px); }
.mood-bar {
    width: 100%;
    height: clamp(8px, 1.2vw, 14px);
    background: rgba(255,255,255,0.25);
    border-radius: 999px;
    position: relative;
    overflow: hidden;
    min-width: clamp(100px, 20vw, 240px);
    max-width: clamp(200px, 32vw, 480px);
}
.mood-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #66bb6a, #4ecdc4);
    border-radius: 999px;
}
.mood-bar.overcap::after {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(45deg, rgba(255,255,255,0.18) 0 8px, rgba(255,255,255,0.05) 8px 16px);
    animation: moodStripes 1.2s linear infinite;
}
@keyframes moodStripes {
    from { background-position: 0 0; }
    to { background-position: 32px 0; }
}
.mood-text { white-space: nowrap; }
.mood-badge { color: #4ecdc4; margin-left: 6px; }

/* 行动点图标 */
.action-points-display::before {
    content: '⚡';
    margin-right: 6px;
    color: #ffd54f;
    filter: drop-shadow(0 0 2px rgba(255,213,79,0.6));
}

/* 刷新NPC按钮 - 响应式改进 */
.refresh-npc-btn {
    position: absolute;
    top: clamp(10px, 3%, 30px);
    right: clamp(10px, 3%, 30px);
    padding: clamp(6px, 1.5vw, 10px) clamp(12px, 2.5vw, 20px);
    background: rgba(44, 44, 44, 0.9);
    color: #fff;
    border: 2px solid #1a1a1a;
    cursor: pointer;
    font-size: clamp(0.7rem, 1.8vw, 0.875rem);
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.refresh-npc-btn:hover {
    background: #3c3c3c;
    transform: translateY(-2px);
}

/* SLG模式返回按钮 */
/* .slg-return-btn {
    position: absolute;
    top: clamp(10px, 3%, 30px);
    left: clamp(10px, 3%, 30px);
    padding: clamp(6px, 1.5vw, 10px) clamp(12px, 2.5vw, 20px);
    background: rgba(44, 44, 44, 0.9);  
    color: #fff;  
    border: 2px solid #1a1a1a;  
    cursor: pointer;
    font-size: clamp(0.7rem, 1.8vw, 0.875rem);
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    display: none;
    z-index: 1000;  
}

.slg-return-btn:hover {
    background: #3c3c3c;  
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
} */

/* 在SLG模式下调整状态显示的位置，避免与返回按钮重叠 */
/* .scene.slg-mode .status-display {
    top: clamp(50px, 8%, 70px);  
} */

/* SLG遮罩层样式更新 */
.slg-interaction-mask {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    z-index: 5;
    pointer-events: auto;
}

/* 确保SLG返回按钮在所有元素之上，包括弹窗 */
/* .slg-return-btn {
    z-index: 2500; 
} */

/* 禁用SLG模式下的地点点击 */
.scene.slg-mode .location {
    pointer-events: none !important;
    cursor: default !important;
}

/* 禁用SLG模式下的刷新NPC按钮 */
.scene.slg-mode .refresh-npc-btn {
    display: none !important;
}


/* 中间控制按钮组 - 响应式改进 */
.control-buttons {
    width: 100%;
    max-width: 100%;  /* 全部改为动态宽度 */
    margin: 0 auto;
    display: flex;
    box-sizing: border-box;
}

.control-btn {
    flex: 1;
    padding: clamp(10px, 2vw, 15px) clamp(15px, 3vw, 30px);
    background: #2c2c2c;
    color: #fff;
    border: 3px solid #2c2c2c;
    border-top: none;
    cursor: pointer;
    font-size: clamp(0.75rem, 2vw, 1rem);
    font-weight: bold;
    transition: all 0.3s ease;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

@media (max-width: 480px) {
    .control-btn {
        padding: 10px 5px;
        font-size: 0.75rem;
    }
}

.control-btn:hover {
    background: #3c3c3c;
}

.control-btn:first-child {
    border-right: none;
}

.control-btn:last-child {
    border-left: none;
}

/* 地点按钮 */
.location {
    position: absolute;
    width: clamp(12px, 2vw, 16px);
    height: clamp(12px, 2vw, 16px);
    border-radius: 50%;
    background: #fff;
    border: 2px solid #2c2c2c;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

.location:hover {
    transform: scale(1.5);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

/* 地点位置 */
#yanwuchang { top: 51%; left: 44%; }
#cangjingge { top: 25%; left: 14%; }
#huofang { top: 50%; left: 62%; }
#houshan { top: 25%; left: 90%; }
#yishiting { top: 12%; left: 55%; }
#tiejiangpu { top: 55%; left: 82%; }
#nandizi { top: 27%; left: 63%; }
#nvdizi { top: 25%; left: 38%; }
#shanmen { top: 85%; left: 33%; }
#gongtian { top: 45%; left: 12.5%; }
#danfang { top: 40%; left: 30%; }

/* 悬浮提示框 - 响应式改进 */
.tooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    padding: 0;
    border-radius: 5px;
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 1000;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    min-width: clamp(100px, 20vw, 150px);
    max-width: 90vw;
}

.tooltip.show {
    opacity: 1;
}

.tooltip-item {
    padding: clamp(6px, 1.5vw, 8px) clamp(10px, 2vw, 15px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    white-space: nowrap;
}

.tooltip-item:last-child {
    border-bottom: none;
}

.tooltip-location {
    font-weight: bold;
    font-size: clamp(0.875rem, 2vw, 1rem);
    color: #4ecdc4;
}

/* 地点信息弹窗 - 新增 */
.location-info-popup {
    position: fixed;
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    padding: clamp(15px, 3vw, 20px);
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    z-index: 2000;
    min-width: clamp(180px, 35vw, 250px);
    text-align: center;
    display: none;
}

.location-info-popup.show {
    display: block;
}

.location-info-name {
    font-size: clamp(1.2rem, 3vw, 1.5rem);
    font-weight: bold;
    margin-bottom: clamp(8px, 2vw, 10px);
    color: #4ecdc4;
}

.location-info-npcs {
    font-size: clamp(0.8rem, 2vw, 1rem);
    color: #ccc;
    margin-bottom: clamp(12px, 3vw, 15px);
    line-height: 1.4;
}

.location-info-npc-item {
    margin: 5px 0;
}

.location-go-btn {
    padding: clamp(8px, 2vw, 10px) clamp(25px, 5vw, 35px);
    background: #4ecdc4;
    color: #1a1a1a;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: clamp(0.9rem, 2.2vw, 1.1rem);
    font-weight: bold;
    transition: all 0.3s ease;
}

.location-go-btn:hover {
    background: #3dbbb3;
    transform: scale(1.05);
}

/* 返回按钮 - 响应式改进 */
.back-btn {
    position: absolute;
    top: clamp(10px, 2vw, 20px);
    left: clamp(10px, 2vw, 20px);
    padding: clamp(6px, 1.5vw, 10px) clamp(12px, 2.5vw, 20px);
    background: #2c2c2c;
    color: #fff;
    border: 2px solid #1a1a1a;
    cursor: pointer;
    font-size: clamp(0.8rem, 2vw, 1rem);
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    z-index: 100;
}

.back-btn:hover {
    background: #3c3c3c;
    transform: translateY(-2px);
}

/* 场景标题 - 响应式改进 */
.scene-title {
    position: absolute;
    top: clamp(20px, 3vw, 30px);
    left: 50%;
    transform: translateX(-50%);
    font-size: clamp(1.5rem, 4vw, 2.25rem);
    font-weight: bold;
    color: #000000;
    text-shadow: 
        -1px -1px 0 #fff,
        1px -1px 0 #fff,
        -1px 1px 0 #fff,
        1px 1px 0 #fff;  /* 默认使用1px描边 */
    letter-spacing: clamp(5px, 1vw, 10px);
}

/* 手机端使用更细的描边 */
@media (max-width: 768px) {
    .scene-title {
        text-shadow: 
            -0.5px -0.5px 0 #fff,
            0.5px -0.5px 0 #fff,
            -0.5px 0.5px 0 #fff,
            0.5px 0.5px 0 #fff;
    }
}

/* PC端和平板使用稍粗的描边 */
@media (min-width: 769px) {
    .scene-title {
        text-shadow: 
            -1.5px -1.5px 0 #fff,
            1.5px -1.5px 0 #fff,
            -1.5px 1.5px 0 #fff,
            1.5px 1.5px 0 #fff,
            -1px 0 0 #fff,
            1px 0 0 #fff,
            0 -1px 0 #fff,
            0 1px 0 #fff;
    }
}

/* NPC立绘容器 */
.npc-container {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

/* NPC立绘 - 修改为70%大小 */
.npc-portrait {
    position: absolute;
    bottom: 0;
    width: 70%;  /* 从60%改为70% */
    height: 70%; /* 从60%改为70% */
    cursor: pointer;
    pointer-events: auto;
    transition: filter 0.3s ease;
}

.npc-portrait:hover {
    filter: brightness(1.1);
}

.npc-portrait img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: bottom center;
}

/* 单个NPC时的位置 */
.npc-portrait.single {
    left: 50%;
    transform: translateX(-50%);
}

/* 两个NPC时的位置 - 修改为30%和70% */
.npc-portrait.double-left {
    left: 30%;  /* 从33%改为30% */
    transform: translateX(-50%);
}

.npc-portrait.double-right {
    left: 70%;  /* 从66%改为70% */
    transform: translateX(-50%);
}

/* NPC信息弹窗 - 修复响应式问题 */
.npc-info-popup {
    position: fixed;  /* 改为fixed定位 */
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    padding: clamp(12px, 3vw, 20px);
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    z-index: 2000;  /* 提高z-index */
    min-width: clamp(150px, 30vw, 200px);
    max-width: 90vw;
    text-align: center;
    display: none;
}

.npc-info-popup.show {
    display: block;
}

.npc-info-name {
    font-size: clamp(1.2rem, 3vw, 1.5rem);
    font-weight: bold;
    margin-bottom: clamp(8px, 2vw, 10px);
}

.npc-info-desc {
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
    color: #ccc;
    margin-bottom: clamp(10px, 2.5vw, 15px);
    line-height: 1.4;
}

.npc-info-actions {
    display: flex;
    gap: clamp(8px, 2vw, 10px);
    justify-content: center;
}

.npc-info-btn {
    padding: clamp(6px, 1.5vw, 8px) clamp(10px, 2.5vw, 15px);
    background: #fff;
    color: #1a1a1a;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
    font-weight: bold;
    transition: all 0.3s ease;
}

.npc-info-btn:hover {
    background: #f0f0f0;
    transform: scale(1.05);
}

.npc-info-btn.disabled {
    background: #ccc;
    cursor: not-allowed;
    opacity: 0.6;
}

.npc-info-btn.disabled:hover {
    background: #ccc;
    transform: none;
}

/* 场景交互按钮容器 - 响应式改进 */
.scene-actions {
    position: absolute;
    bottom: clamp(20px, 3vw, 30px);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: clamp(10px, 2vw, 15px);
    z-index: 100;
}

/* 场景交互按钮 - 响应式改进 */
.scene-btn {
    padding: clamp(8px, 2vw, 12px) clamp(20px, 4vw, 30px);
    background: #2c2c2c;
    color: #fff;
    border: 2px solid #1a1a1a;
    border-radius: 5px;
    cursor: pointer;
    font-size: clamp(0.8rem, 2vw, 1rem);
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    white-space: nowrap;
}

.scene-btn:hover:not(:disabled) {
    background: #fff;
    color: #2c2c2c;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
}

.scene-btn:disabled {
    background: #666;
    cursor: not-allowed;
    opacity: 0.6;
}

/* 属性展示容器 */
.stats-container {
    position: absolute;
    top: clamp(60px, 10vw, 80px);
    left: 50%;
    transform: translateX(-50%);
    width: 85%;
    max-width: 600px;
    max-height: calc(100% - clamp(80px, 15vw, 100px));
    overflow-y: auto;
    padding-right: 10px;
}

/* 属性分组 */
.stats-group {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid #2c2c2c;
    border-radius: 10px;
    padding: clamp(15px, 3vw, 25px);
    margin-bottom: clamp(15px, 3vw, 20px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.stats-group h3 {
    font-size: clamp(1.2rem, 3vw, 1.5rem);
    color: #2c2c2c;
    margin-bottom: clamp(15px, 3vw, 20px);
    text-align: center;
    letter-spacing: 3px;
}

/* 属性项 */
.stat-item {
    display: flex;
    align-items: center;
    margin-bottom: clamp(10px, 2vw, 15px);
}

.stat-name {
    width: clamp(60px, 15vw, 100px);
    font-size: clamp(0.9rem, 2.2vw, 1.125rem);
    font-weight: bold;
    color: #2c2c2c;
}

.stat-bar {
    flex: 1;
    height: clamp(20px, 4vw, 25px);
    background: #e0e0e0;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    margin: 0 clamp(10px, 2vw, 15px);
}

.stat-fill {
    height: 100%;
    background: linear-gradient(to right, #4a4a4a, #2c2c2c);
    transition: width 0.5s ease;
}

.stat-value {
    font-size: clamp(0.9rem, 2.2vw, 1.125rem);
    font-weight: bold;
    color: #2c2c2c;
    width: clamp(40px, 8vw, 50px);
    text-align: right;
}

/* 下方数值分组容器 */
.bottom-stats-row {
    display: flex;
    gap: clamp(15px, 3vw, 20px);
}

@media (max-width: 600px) {
    .bottom-stats-row {
        flex-direction: column;
    }
}

.bottom-stats-row .stats-group {
    flex: 1;
}

/* 简单数值项 */
.simple-stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: clamp(10px, 2vw, 15px);
    font-size: clamp(0.8rem, 2vw, 1rem);
}

.simple-stat-name {
    font-weight: bold;
    color: #2c2c2c;
}

.simple-stat-value {
    font-weight: bold;
    color: #4a4a4a;
}

/* 加点按钮 */
.point-control {
    display: flex;
    align-items: center;
    gap: clamp(8px, 2vw, 10px);
}

.add-point-btn {
    padding: clamp(3px, 0.8vw, 4px) clamp(8px, 2vw, 12px);
    background: #4ecdc4;
    color: #fff;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
    font-weight: bold;
    transition: all 0.3s ease;
}

.add-point-btn:hover:not(:disabled) {
    background: #3dbbb3;
    transform: scale(1.05);
}

.add-point-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    opacity: 0.6;
}

/* 武功列表 */
.skill-list {
    margin-top: clamp(10px, 2vw, 15px);
}

.skill-item {
    padding: 5px 0;
    color: #4a4a4a;
    font-size: clamp(0.8rem, 1.9vw, 0.9375rem);
}

/* 关系卡片容器 - 响应式改进 */
.relationships-container {
    position: absolute;
    top: clamp(60px, 10vw, 80px);
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-height: calc(100% - clamp(80px, 15vw, 100px));
    overflow-y: auto;
    padding: clamp(10px, 2vw, 20px);
}

/* 关系卡片网格 - 固定3列2行 */
.relationship-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: clamp(10px, 2vw, 20px);
    max-height: calc(100% - 20px);
}

/* 只显示前6个，其余通过滚动查看 */
.relationship-grid > :nth-child(n+7) {
    display: block;
}

.relationship-card {
    background: #fff;
    border: 2px solid #2c2c2c;
    border-radius: 10px;
    padding: 0; /* 改为0，因为立绘需要紧贴上边缘 */
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.relationship-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.relationship-info {
    padding: clamp(10px, 2vw, 15px);
}

.relationship-portrait {
    width: 100%;
    height: auto;
    position: relative;
    overflow: hidden;
    margin-bottom: clamp(5px, 1vw, 8px);
}

.relationship-portrait img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
    object-position: top center;
}

.relationship-name {
    font-size: clamp(0.8rem, 2vw, 1rem);
    font-weight: bold;
    margin-bottom: clamp(8px, 1.5vw, 10px);
    color: #2c2c2c;
}

.relationship-bar {
    width: 100%;
    height: clamp(15px, 3vw, 20px);
    background: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 5px;
}

.relationship-fill {
    height: 100%;
    background: linear-gradient(to right, #ff6b6b, #4ecdc4);
    transition: width 0.5s ease;
}

.relationship-value {
    font-size: clamp(0.7rem, 1.8vw, 0.875rem);
    color: #666;
}

/* 弹窗 - 响应式改进 */
.modal {
    display: none;
    position: absolute;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    padding: 20px;
}

.modal-content {
    background-color: #fff;
    margin: auto;
    padding: clamp(20px, 4vw, 30px);
    border: 3px solid #2c2c2c;
    width: min(400px, 100%);
    max-width: 90%;
    max-height: 80%;
    overflow-y: auto;
    text-align: center;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    position: absolute;  /* 改为absolute定位 */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);  /* 居中定位 */
}

.modal-text {
    font-size: clamp(1rem, 2.5vw, 1.25rem);
    font-weight: bold;
    color: #2c2c2c;
    margin-bottom: clamp(15px, 3vw, 20px);
    line-height: 1.6;
}

.modal-buttons {
    display: flex;
    gap: clamp(10px, 2vw, 15px);
    justify-content: center;
    flex-wrap: wrap;
}

.modal-btn {
    padding: clamp(8px, 2vw, 10px) clamp(20px, 4vw, 30px);
    background: #2c2c2c;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: clamp(0.8rem, 2vw, 1rem);
    font-weight: bold;
}

.modal-btn:hover {
    background: #3c3c3c;
}

.modal-btn.cancel {
    background: #666;
}

.modal-btn.cancel:hover {
    background: #555;
}

/* 输入框样式 */
.input-area {
    margin: clamp(15px, 3vw, 20px) 0;
}

.input-field {
    width: 100%;
    padding: clamp(8px, 2vw, 10px);
    font-size: clamp(0.8rem, 2vw, 1rem);
    border: 2px solid #2c2c2c;
    border-radius: 5px;
    resize: vertical;
    min-height: clamp(80px, 15vw, 100px);
    max-height: 200px;
    font-family: "Microsoft YaHei", "SimSun", serif;
}

.input-field:focus {
    outline: none;
    border-color: #4ecdc4;
}

/* 互动内容自动换行样式 */
.interaction-content {
    word-wrap: break-word;
    word-break: break-all;
    white-space: pre-wrap;
    text-align: left;
    max-width: 100%;
    display: inline-block;
}

/* 故事区域 */
.story-area {
    position: relative;
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    background: #fff;
    border: 3px solid #2c2c2c;
    border-top: none;
    padding: clamp(15px, 3vw, 25px);
    padding-bottom: clamp(35px, 5vw, 45px);
    min-height: clamp(120px, 20vw, 180px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    box-sizing: border-box;
}

/* 故事文本 */
.story-text {
    font-size: clamp(0.9rem, 2.2vw, 1.125rem);
    line-height: 1.8;
    color: #2c2c2c;
    text-indent: 2em;
    font-family: "Microsoft YaHei", "SimSun", serif;
}

/* 水墨效果装饰 */
.ink-decoration {
    position: absolute;
    width: clamp(60px, 12vw, 100px);
    height: clamp(60px, 12vw, 100px);
    background: radial-gradient(circle, rgba(0,0,0,0.1) 0%, transparent 70%);
    border-radius: 50%;
    pointer-events: none;
}

.ink1 { top: 10%; right: 10%; }
.ink2 { bottom: 10%; left: 5%; }

/* 滚动条样式 */
.stats-container::-webkit-scrollbar,
.relationships-container::-webkit-scrollbar {
    width: 8px;
}

.stats-container::-webkit-scrollbar-track,
.relationships-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.stats-container::-webkit-scrollbar-thumb,
.relationships-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
}

.stats-container::-webkit-scrollbar-thumb:hover,
.relationships-container::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* 21点游戏iframe弹窗 - 新增 */
.blackjack-modal {
    display: none;
    position: absolute;  /* 从fixed改为absolute */
    z-index: 3000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
}

.blackjack-container {
    width: 100%;  /* 改为100% */
    height: 100%;  /* 改为100% */
    margin: 0;  /* 移除margin */
    position: relative;
}

.blackjack-iframe {
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 10px;
}

/* 响应式调整 */
@media (max-width: 840px) {
    .container {
        padding: 0;
    }
    
    .viewport-wrapper {
        max-width: 100%;
    }
}

/* 移动端适配调整 */
@media (max-width: 600px) {
    .story-content-wrapper {
        padding-top: 25px;  /* 移动端稍微减少顶部padding */
        padding-bottom: 20px;
    }
    
    .page-indicator {
        top: 3px;  /* 移动端更贴近顶部 */
    }
    
    .story-expand-btn {
        font-size: 0.7rem;
        padding: 3px 12px;
        bottom: -20px;  /* 移动端稍微减少距离 */
    }
    
    .story-area {
        padding-bottom: 30px;  /* 移动端减少底部padding */
    }
}

/* 随机事件框样式 - 响应式优化 */
.random-event-container {
    background: rgba(44, 44, 44, 0.95);
    border: 2px solid #4ecdc4;
    border-radius: 10px;
    padding: clamp(12px, 3vw, 20px);
    margin-top: clamp(12px, 3vw, 20px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: none;
}

.random-event-container.show {
    display: block;
}

.event-title {
    font-size: clamp(1rem, 2.5vw, 1.25rem);
    font-weight: bold;
    color: #4ecdc4;
    margin-bottom: clamp(6px, 1.5vw, 10px);
    text-align: center;
}

.event-description {
    display: none; /* 事件描述移至正文最后一页，这里隐藏 */
}

.event-options {
    display: flex;
    flex-direction: column;
    gap: clamp(8px, 2vw, 15px);
}

.event-option-btn {
    background: #2c2c2c;
    border: 2px solid #4ecdc4;
    border-radius: 8px;
    padding: clamp(10px, 2.5vw, 15px);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
}

.event-option-btn:hover {
    background: #3c3c3c;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
}

.option-desc {
    font-size: clamp(0.875rem, 2vw, 1rem);
    color: #fff;
    margin-bottom: clamp(5px, 1vw, 8px);
    line-height: 1.4;
}

.option-reward {
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
    color: #4ecdc4;
    margin-bottom: clamp(3px, 0.8vw, 5px);
}

.option-success-rate {
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
    color: #aaa;
}

/* 小屏幕优化 */
@media (max-width: 600px) {
    .random-event-container {
        margin-top: 10px;
        padding: 10px;
    }
    
    .event-options {
        gap: 6px;
    }
    
    .event-option-btn {
        padding: 8px 10px;
        border-radius: 6px;
    }
    
    /* 在非常小的屏幕上，减少行间距 */
    .option-desc {
        margin-bottom: 3px;
    }
    
    .option-reward {
        margin-bottom: 2px;
    }
}

/* 横屏手机优化 */
@media (max-height: 500px) and (orientation: landscape) {
    .random-event-container {
        padding: 8px 12px;
        margin-top: 8px;
    }
    
    .event-title {
        margin-bottom: 5px;
    }
    
    .event-description { display: none; }
    
    .event-options {
        gap: 5px;
    }
    
    .event-option-btn {
        padding: 6px 10px;
    }
}

/* 平板和小窗口优化 */
@media (min-width: 600px) and (max-width: 840px) {
    .random-event-container {
        padding: 15px;
        margin-top: 15px;
    }
    
    .event-options {
        gap: 10px;
    }
    
    .event-option-btn {
        padding: 12px;
    }
}

/* 战斗信息框样式 */
.battle-event-container {
    background: rgba(44, 44, 44, 0.95);
    border: 2px solid #ff4d6d;
    border-radius: 10px;
    padding: clamp(12px, 3vw, 20px);
    margin-top: clamp(12px, 3vw, 20px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: none;
}

.battle-event-container.show {
    display: block;
}

/* 当事件容器被放置到主视窗(#main-viewport)内时的定位与层级（覆盖默认样式） */
#main-viewport > #random-event-container,
#main-viewport > #battle-event-container {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: clamp(10px, 3vw, 16px);
    width: calc(100% - clamp(16px, 4vw, 24px));
    max-width: 900px;
    z-index: 1500; /* 高于SLG遮罩层(z-index:5)与普通层，低于全屏modal */
    max-height: calc(100% - clamp(80px, 12vw, 120px)); /* 不超过主视窗范围 */
    overflow-y: auto; /* 容器自身滚动 */
}

/* 事件框滚动条样式（Chrome/Edge/Safari） */
#main-viewport > #random-event-container::-webkit-scrollbar,
#main-viewport > #battle-event-container::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

#main-viewport > #random-event-container::-webkit-scrollbar-track,
#main-viewport > #battle-event-container::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 8px;
}

/* 随机事件：青色拇指 */
#main-viewport > #random-event-container::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, rgba(78,205,196,0.95), rgba(78,205,196,0.6));
    border-radius: 8px;
    border: 2px solid rgba(44,44,44,0.95);
    transition: background 0.2s ease;
}
#main-viewport > #random-event-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #4ecdc4, rgba(78,205,196,0.75));
}

/* 战斗事件：粉红拇指 */
#main-viewport > #battle-event-container::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, rgba(255,77,109,0.95), rgba(255,77,109,0.6));
    border-radius: 8px;
    border: 2px solid rgba(44,44,44,0.95);
    transition: background 0.2s ease;
}
#main-viewport > #battle-event-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #ff6b87, rgba(255,77,109,0.75));
}

/* Firefox 滚动条配色 */
#main-viewport > #random-event-container {
    scrollbar-width: thin;
    scrollbar-color: rgba(78,205,196,0.9) rgba(255,255,255,0.08);
}
#main-viewport > #battle-event-container {
    scrollbar-width: thin;
    scrollbar-color: rgba(255,77,109,0.9) rgba(255,255,255,0.08);
}

.battle-event-title {
    font-size: clamp(1rem, 2.5vw, 1.25rem);
    font-weight: bold;
    color: #ff4d6d;
    margin-bottom: clamp(6px, 1.5vw, 10px);
    text-align: center;
}

.battle-event-description {
    display: none; /* 事件描述移至正文最后一页，这里隐藏 */
}

.battle-enemy-info {
    background: rgba(0, 0, 0, 0.5);
    padding: clamp(10px, 2vw, 15px);
    border-radius: 8px;
    margin-bottom: clamp(10px, 2vw, 15px);
    max-height: 100%;
    overflow-y: auto;
}

.enemy-info-item {
    font-size: clamp(0.8rem, 1.8vw, 0.9rem);
    color: #ccc;
    margin: clamp(3px, 0.8vw, 5px) 0;
}

.enemy-info-label {
    color: #ff4d6d;
    font-weight: bold;
}

.battle-reward {
    background: rgba(78, 205, 196, 0.2);
    padding: clamp(8px, 2vw, 12px);
    border-radius: 6px;
    margin-bottom: clamp(12px, 3vw, 20px);
    text-align: center;
    max-height: 100%;
    overflow-y: auto;
}

.battle-reward-text {
    font-size: clamp(0.875rem, 2vw, 1rem);
    color: #4ecdc4;
}

.battle-actions {
    display: flex;
    gap: clamp(10px, 2vw, 15px);
    justify-content: center;
}

.battle-action-btn {
    flex: 1;
    padding: clamp(8px, 2vw, 12px) clamp(20px, 4vw, 30px);
    border: 2px solid #ff4d6d;
    border-radius: 8px;
    cursor: pointer;
    font-size: clamp(0.875rem, 2vw, 1rem);
    font-weight: bold;
    transition: all 0.3s ease;
}

.battle-action-btn.fight {
    background: #ff4d6d;
    color: #fff;
}

.battle-action-btn.fight:hover {
    background: #ff6b87;
    transform: translateY(-2px);
}

.battle-action-btn.flee {
    background: #2c2c2c;
    color: #fff;
    border-color: #666;
}

.battle-action-btn.flee:hover {
    background: #3c3c3c;
    transform: translateY(-2px);
}

/* 战斗iframe弹窗 */
.battle-modal {
    display: none;
    position: absolute;  /* 从fixed改为absolute */
    z-index: 3000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
}

.battle-container {
    width: 100%;  /* 改为100% */
    height: 100%;  /* 改为100% */
    margin: 0;  /* 移除margin */
    position: relative;
}

.battle-iframe {
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 10px;
}
/* 自由行动输入框容器 */
.free-action-container {
    width: 100%;
    max-width: 100%;  /* 全部改为动态宽度 */
    margin: 0 auto;
    background: #fff;
    border: 3px solid #2c2c2c;
    border-bottom: none;
    padding: clamp(10px, 2vw, 15px);
    display: flex;
    gap: 10px;
    align-items: flex-start;
    box-sizing: border-box;
}

/* 自由行动输入框 */
.free-action-input {
    flex: 1;
    min-height: 36px;
    max-height: 120px;
    padding: clamp(6px, 1.5vw, 10px) clamp(10px, 2vw, 15px);
    font-size: clamp(0.8rem, 2vw, 1rem);
    font-family: "Microsoft YaHei", "SimSun", serif;
    border: 2px solid #ddd;
    border-radius: 5px;
    resize: none;
    overflow-y: auto;
    line-height: 1.4;
    transition: border-color 0.3s ease;
}

.free-action-input:focus {
    outline: none;
    border-color: #4ecdc4;
}

.free-action-input::placeholder {
    color: #999;
}

/* 发送按钮 */
.free-action-send-btn {
    padding: clamp(8px, 2vw, 12px) clamp(20px, 4vw, 30px);
    background: #2c2c2c;
    color: #fff;
    border: 2px solid #1a1a1a;
    border-radius: 5px;
    cursor: pointer;
    font-size: clamp(0.8rem, 2vw, 1rem);
    font-weight: bold;
    transition: all 0.3s ease;
    white-space: nowrap;
    min-height: 36px;
}

.free-action-send-btn:hover {
    background: #3c3c3c;
    transform: translateY(-1px);
}

.free-action-send-btn:active {
    transform: translateY(0);
}

/* 响应式调整 */
@media (max-width: 600px) {
    .free-action-container {
        padding: 8px;
        gap: 8px;
    }
    
    .free-action-input {
        min-height: 32px;
        font-size: 0.8rem;
    }
    
    .free-action-send-btn {
        padding: 8px 15px;
        min-height: 32px;
    }
}

/* 故事区域改造 */
.story-area {
    position: relative;
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    background: #fff;
    border: 3px solid #2c2c2c;
    border-top: none;
    padding: clamp(15px, 3vw, 25px);
    min-height: clamp(120px, 20vw, 180px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    box-sizing: border-box;
}

/* 故事文本容器 */
.story-content-wrapper {
    position: relative;
    width: 100%;
    padding-top: 35px;  /* 新增：为页面指示器留出空间 */
    padding-bottom: 25px;  /* 新增：为展开按钮留出空间 */
}

/* 页面指示器 */
.page-indicator {
    position: absolute;
    top: clamp(5px, 1vw, 10px);  /* 从10px改为5px，减少与顶部的距离 */
    left: clamp(10px, 2vw, 15px);
    display: flex;
    gap: clamp(6px, 1.5vw, 8px);
    z-index: 10;
}

.page-dot {
    width: clamp(8px, 1.5vw, 10px);
    height: clamp(8px, 1.5vw, 10px);
    border-radius: 50%;
    background: #ccc;
    cursor: pointer;
    transition: all 0.3s ease;
}

.page-dot:hover {
    background: #999;
    transform: scale(1.2);
}

.page-dot.active {
    background: #2c2c2c;
    transform: scale(1.3);
}

/* 翻页箭头 */
.story-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: clamp(30px, 6vw, 40px);
    height: clamp(40px, 8vw, 60px);
    background: rgba(44, 44, 44, 0.8);
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: clamp(16px, 3vw, 20px);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
}

.story-nav-btn:hover:not(:disabled) {
    background: rgba(44, 44, 44, 0.95);
    transform: translateY(-50%) scale(1.1);
}

.story-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.story-nav-btn.prev {
    left: clamp(-35px, -7vw, -45px);
    border-radius: 0 5px 5px 0;
}

.story-nav-btn.next {
    right: clamp(-35px, -7vw, -45px);
    border-radius: 5px 0 0 5px;
}

/* 展开/收起按钮 */
.story-expand-btn {
    position: absolute;
    bottom: -25px;  /* 从-15px改为-25px，向下移动更多 */
    left: 50%;
    transform: translateX(-50%);
    padding: clamp(4px, 1vw, 6px) clamp(15px, 3vw, 20px);
    background: #2c2c2c;
    color: #fff;
    border: none;
    border-radius: 0 0 8px 8px;
    cursor: pointer;
    font-size: clamp(0.7rem, 1.8vw, 0.875rem);
    transition: all 0.3s ease;
    white-space: nowrap;
    z-index: 10;
}

.story-expand-btn:hover {
    background: #3c3c3c;
    padding-bottom: clamp(6px, 1.5vw, 8px);
}

/* 故事文本样式调整 */
.story-text {
    font-size: clamp(0.9rem, 2.2vw, 1.125rem);
    line-height: 1.8;
    color: #2c2c2c;
    text-indent: 2em;
    font-family: "Microsoft YaHei", "SimSun", serif;
    min-height: clamp(80px, 15vw, 120px);
    transition: all 0.3s ease;
    /* padding-top: 20px;  如果上面的wrapper padding不够，可以加这行 */
}

/* 展开状态 */
.story-text.expanded {
    max-height: none;  /* 移除最大高度限制 */
    overflow-y: visible;  /* 改为visible，不显示滚动条 */
    padding-right: 0;  /* 移除右侧padding */
}

/* 移动端适配 */
@media (max-width: 600px) {
    .story-nav-btn {
        width: 25px;
        height: 35px;
        font-size: 14px;
    }
    
    .story-nav-btn.prev {
        left: -28px;
    }
    
    .story-nav-btn.next {
        right: -28px;
    }
    
    .page-dot {
        width: 6px;
        height: 6px;
    }
    
    .story-expand-btn {
        font-size: 0.7rem;
        padding: 3px 12px;
        bottom: -12px;
    }
}

/* SLG模式图层样式 */
.slg-layer-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

/* SLG全局模式：隐藏普通场景（地图与各地点） */
.slg-global .scene {
    display: none !important;
}

.slg-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.slg-layer img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
}

/* 场景图层（最底层） */
.slg-scene-layer {
    z-index: 1;
}

/* NPC表情图层（中层） */
.slg-emotion-layer {
    z-index: 2;
}

/* 特殊CG图层（最顶层） */
.slg-cg-layer {
    z-index: 3;
}

/* 确保故事文本在图层之上 */
.story-area {
    position: relative;
    z-index: 10;
}

/* SLG模式下，确保viewport的scene在图层下方 */
.scene.active {
    z-index: 0;
}

/* SLG模式遮罩层 - 阻止场景互动 */
.slg-interaction-mask {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    z-index: 5; /* 在场景内容之上，但在SLG图层之下 */
    pointer-events: auto; /* 捕获所有点击事件 */
}

/* SLG模式下禁用的元素样式 */
.slg-mode-disabled {
    pointer-events: none !important;
    cursor: default !important;
}

.slg-mode-disabled:hover {
    filter: none !important;
    transform: none !important;
}

/* SLG模式下隐藏场景按钮 */
.scene.active .scene-btn {
    display: block;
}

.scene.active.slg-mode .scene-btn {
    display: none !important;
}

/* SLG模式下隐藏刷新NPC按钮 */
.scene.active.slg-mode .refresh-npc-btn {
    display: none !important;
}

/* 确保SLG图层容器在遮罩层之上 */
.slg-layer-container {
    z-index: 10; /* 提高z-index */
}

/* SLG加载图层（位于场景图层之下，用于遮挡非SLG场景） */
.slg-loading-layer {
    z-index: 0;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    pointer-events: none; /* 不拦截交互 */
}

.slg-loading-spinner {
    width: clamp(48px, 12vw, 140px);
    height: clamp(48px, 12vw, 140px);
    background-image: url('https://files.catbox.moe/37jfr9.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    animation: slgSpin 8s linear infinite;
    opacity: 0.9;
}

@keyframes slgSpin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* 加载文字与动态省略号 */
.slg-loading-text {
    margin-top: clamp(8px, 2vw, 16px);
    font-size: clamp(12px, 2.2vw, 20px);
    color: #222;
    font-weight: bold;
    letter-spacing: 1px;
    text-align: center;
}

.slg-loading-text::after {
    content: '.';
    animation: slgDots 1.5s linear infinite;
    display: inline-block;
    width: 1.5em; /* 视觉占位，避免抖动 */
    margin-left: 2px;
}

@keyframes slgDots {
    0%   { content: '.'; }
    16%  { content: '..'; }
    33%  { content: '...'; }
    50%  { content: '....'; }
    66%  { content: '.....'; }
    83%  { content: '......'; }
    100% { content: '.'; }
}
/* 关系卡片控制区域 */
.relationship-controls {
    margin-top: clamp(8px, 2vw, 12px);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: clamp(8px, 2vw, 10px);
}

/* 可见性勾选框 */
.visibility-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: clamp(0.7rem, 1.8vw, 0.85rem);
}

.visibility-checkbox input[type="checkbox"] {
    width: clamp(14px, 3vw, 18px);
    height: clamp(14px, 3vw, 18px);
    margin-right: clamp(4px, 1vw, 6px);
    cursor: pointer;
}

.checkbox-label {
    color: #666;
    font-weight: normal;
}

/* 送礼按钮 */
.gift-btn {
    padding: clamp(4px, 1vw, 6px) clamp(8px, 2vw, 12px);
    background: #2c2c2c;
    color: #fff;
    border: 1px solid #1a1a1a;
    border-radius: 4px;
    cursor: pointer;
    font-size: clamp(0.65rem, 1.6vw, 0.8rem);
    font-weight: bold;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.gift-btn:hover:not(.disabled) {
    background: #3c3c3c;
    transform: translateY(-1px);
}

.gift-btn.disabled {
    background: #666;
    cursor: not-allowed;
    opacity: 0.6;
}

/* 调整关系卡片以适应新内容 */
.relationship-card {
    background: #fff;
    border: 2px solid #2c2c2c;
    border-radius: 10px;
    padding: 0;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

/* 移动端优化 */
@media (max-width: 600px) {
    .relationship-controls {
        flex-direction: column;
        gap: 6px;
    }
    
    .gift-btn {
        width: 100%;
        padding: 6px 10px;
    }
}

/* 确保角色属性和人际关系场景始终可见 */
#player-stats-scene.scene.active,
#relationships-scene.scene.active {
    z-index: 100 !important;
    pointer-events: auto !important;
    display: block !important;
}

/* 确保这两个场景不受SLG遮罩影响 */
#player-stats-scene .slg-interaction-mask,
#relationships-scene .slg-interaction-mask {
    display: none !important;
}

/* #player-stats-scene .back-btn,
#relationships-scene .back-btn {
} */

/* 在SLG模式下，调整返回按钮位置避免重叠 */
/* #player-stats-scene.scene.active .back-btn,
#relationships-scene.scene.active .back-btn {
} */

/* 当SLG返回按钮显示时，调整这两个场景的返回按钮位置
.slg-return-btn:not([style*="display: none"]) ~ * #player-stats-scene.scene.active .back-btn,
.slg-return-btn:not([style*="display: none"]) ~ * #relationships-scene.scene.active .back-btn {
    top: clamp(60px, 10%, 80px);  
} */

/* .back-btn.slg-mode-offset {
    top: clamp(60px, 10%, 80px) !important;  
} */

/* 下拉菜单样式 */
.dropdown-wrapper {
    position: relative;
    flex: 1;
}

.dropdown-toggle {
    width: 100%;
    position: relative;
}

.dropdown-toggle::after {
    content: "";
    transition: transform 0.3s ease;
}

.dropdown-toggle.active::after {
    transform: rotate(180deg);
}

.dropdown-menu {
    display: none;
    position: absolute;
    bottom: 100%;
    left: 0;
    right: 0;
    background: #2c2c2c;
    border: 2px solid #1a1a1a;
    border-bottom: none;
    box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
    z-index: 1000;
}

.dropdown-menu.show {
    display: block;
}

.dropdown-item {
    display: block;
    width: 100%;
    padding: clamp(8px, 2vw, 12px) clamp(15px, 3vw, 20px);
    background: none;
    color: #fff;
    border: none;
    border-bottom: 1px solid #444;
    cursor: pointer;
    font-size: clamp(0.75rem, 2vw, 0.9rem);
    text-align: left;
    transition: background 0.3s ease;
}

.dropdown-item:last-child {
    border-bottom: none;
}

.dropdown-item:hover {
    background: #3c3c3c;
}

/* 难度设置弹窗样式 */
.difficulty-options {
    margin: 20px 0;
}

.difficulty-option {
    display: block;
    margin: 10px 0;
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.difficulty-option:hover {
    border-color: #4ecdc4;
    background: #f9f9f9;
}

.difficulty-option input[type="radio"] {
    margin-right: 10px;
}

.difficulty-option.selected {
    border-color: #4ecdc4;
    background: #e8f8f7;
}

.option-content strong {
    display: block;
    margin-bottom: 5px;
    color: #2c2c2c;
}

.option-content small {
    color: #666;
    font-size: 0.85em;
}

/* 金手指弹窗样式 */
.cheat-content {
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
}

.cheat-sections {
    margin: 20px 0;
}

.cheat-section {
    margin-bottom: 25px;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 8px;
}

.cheat-section h4 {
    margin-bottom: 15px;
    color: #2c2c2c;
    border-bottom: 2px solid #ddd;
    padding-bottom: 5px;
}

.cheat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
}

.cheat-item {
    display: flex;
    flex-direction: column;
}

.cheat-item label {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 5px;
}

.cheat-item input {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1em;
}

.npc-grid {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
}

/* 让覆盖视窗的弹窗占满 #main-viewport */
.modal.viewport-overlay {
    position: fixed;  /* 改为fixed定位，不受滚动影响 */
    z-index: 2500;
    background: rgba(0,0,0,0.6);
    overflow: hidden;
    display: none;  /* 默认隐藏 */
}

/* 确保modal内容正确定位 */
.modal.viewport-overlay .modal-content {
    position: relative;  /* 改回relative，因为容器已经正确定位 */
    transform: none !important;
    border-radius: 0;
    display: flex;
    flex-direction: column;
    overflow: auto;
    margin: 0;
    width: 100%;
    height: 100%;
}

/* 金手指长内容的专属滚动优化 */
.modal.viewport-overlay .cheat-content{
    flex:1;                     /* 把高度全部交给内容区域 */
    overflow:auto;
}

.story-text pre, .story-text code {
    white-space: pre-wrap;   /* 保留空白但允许换行 */
    word-break: break-word;  /* 中文、长单词都可断行 */
}

/* 背包和装备弹窗样式 */
.inventory-content, .equipment-content {
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
}

.inventory-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); /* 从100px改为80px */
    gap: 8px;  /* 从10px改为8px */
    padding: 15px 0;  /* 从20px改为15px */
    max-height: 400px;
    overflow-y: auto;
}

.inventory-item {
    background: #f5f5f5;
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: 8px;  /* 从10px改为8px */
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.inventory-item:hover {
    border-color: #4ecdc4;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.item-icon {
    width: 40px;  /* 从50px改为40px */
    height: 40px;  /* 从50px改为40px */
    margin: 0 auto 5px;
    background: #e0e0e0;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;  /* 从24px改为20px */
}

.item-name {
    font-size: 11px;  /* 从12px改为11px */
    font-weight: bold;
    color: #333;
    margin-bottom: 3px;
}

.item-quantity {
    font-size: 12px;  /* 从14px改为12px */
    color: #666;
}

/* 装备槽样式 */
.equipment-slots {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin: 20px 0;
}

.equipment-slot {
    background: #f5f5f5;
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
}

.slot-label {
    font-weight: bold;
    color: #666;
    margin-bottom: 10px;
    font-size: 14px;
}

.slot-item {
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.empty-slot {
    color: #999;
    font-style: italic;
}

.equipped-item {
    background: #e8f8f7;
    border: 1px solid #4ecdc4;
    border-radius: 4px;
    padding: 8px;
    font-weight: bold;
    color: #2c2c2c;
}

.equipment-stats {
    background: #f9f9f9;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    margin-top: 20px;
}

.equipment-stats h4 {
    margin-bottom: 10px;
    color: #2c2c2c;
}

.stat-effect {
    font-size: 14px;
    color: #4ecdc4;
    margin: 5px 0;
}

#item-detail-modal.modal {
    z-index: 3500; /* 提高z-index，确保在背包弹窗之上 */
}

/* 道具详情弹窗 */
.item-detail-content {
    max-width: 300px;  /* 从400px改为300px，缩小弹窗 */
    max-height: 60vh;  /* 限制高度为视窗的60% */
    overflow-y: auto;
    font-size: 0.9em;  /* 字体稍微缩小 */
}

.item-description {
    font-size: 14px;
    color: #666;
    margin: 15px 0;
    line-height: 1.6;
}

.item-info {
    background: #f5f5f5;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.item-stat {
    font-size: 14px;
    margin: 5px 0;
}

.item-stat-label {
    font-weight: bold;
    color: #666;
}

.unequip-btn {
    background: #ff6b6b;
    color: white;
}

.unequip-btn:hover {
    background: #ff5252;
}

/* 交易弹窗样式 */
.trading-content {
    max-width: 900px;
    max-height: 80vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.trading-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.trading-header h3 {
    margin: 0;
}

.trading-money {
    font-size: 16px;
    font-weight: bold;
    color: #4ecdc4;
}

.trading-container {
    display: flex;
    gap: 20px;
    flex: 1;
    overflow: hidden;
    margin-bottom: 20px;
}

.trading-section {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.trading-section h4 {
    margin-bottom: 15px;
    color: #2c2c2c;
    text-align: center;
    padding-bottom: 10px;
    border-bottom: 2px solid #ddd;
}

.trading-list {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 8px;
}

.trading-divider {
    width: 2px;
    background: #ddd;
    margin: 0 10px;
}

/* 交易物品行 */
.trading-item-row {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    padding: 8px 10px;  /* 减小padding */
    margin-bottom: 6px;  /* 减小间距 */
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
}

.trading-item-row:hover {
    border-color: #4ecdc4;
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.trading-item-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;  /* 减小间距 */
    min-width: 0;  /* 防止文字溢出 */
}

.trading-item-name {
    font-size: 13px;  /* 减小字体 */
    font-weight: bold;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.trading-item-detail {
    display: none;
}

.trading-item-price {
    font-size: 11px;  /* 减小字体 */
    color: #4ecdc4;
    font-weight: bold;
}

/* 详情按钮样式 */
.detail-btn {
    background: #666;
    color: white;
    margin-right: 5px;
}

.detail-btn:hover {
    background: #555;
}

.trading-btn {
    padding: 6px 16px;
    font-size: 13px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.buy-btn {
    background: #4ecdc4;
    color: white;
}

.buy-btn:hover:not(:disabled) {
    background: #3dbbb3;
}

.sell-btn {
    background: #ff6b6b;
    color: white;
}

.sell-btn:hover:not(:disabled) {
    background: #ff5252;
}

.trading-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    opacity: 0.6;
}

/* 响应式调整 - 保持左右布局 */
@media (max-width: 768px) {
    .trading-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }
    
    .trading-money {
        font-size: 14px;
    }
    
    .trading-container {
        gap: 10px;
    }
    
    .trading-item-row {
        padding: 8px 10px;
    }
    
    .trading-item-name {
        font-size: 13px;
    }
    
    .trading-item-detail,
    .trading-item-price {
        font-size: 11px;
    }
    
    .trading-btn {
        padding: 5px 12px;
        font-size: 12px;
    }
}

/* 移动端进一步优化 */
@media (max-width: 480px) {
    .trading-list {
        padding: 5px;
    }
    
    .trading-item-row {
        padding: 6px 8px;
        margin-bottom: 4px;
    }
    
    .trading-item-name {
        font-size: 12px;
    }
    
    .trading-item-price {
        font-size: 10px;
    }
    
    .trading-btn {
        padding: 4px 10px;
        font-size: 11px;
    }
}

/* 地点标签样式（替换原先的圆点光标） */
.location {
    width: 9% !important;                 /* 约等于 main-viewport 宽度的 9% */
    height: auto !important;
    aspect-ratio: 2.5;                     /* 略增高：宽:高 = 2.5:1 -> 高 ≈ 3.6% 视窗宽度 */
    min-height: clamp(24px, 3.4vw, 44px);  /* 防止双行时内容溢出 */
    box-sizing: border-box;
    padding: 0 clamp(4px, 0.6vw, 8px) !important;  /* 只有水平内边距，不影响高度 */
    border-radius: 6px !important;
    background: transparent !important;
    color: #fff !important;
    border: transparent !important;
    font-size: clamp(10px, 2.2vw, 50px) !important; /* 自适应字体 */
    font-weight: bold;
    white-space: nowrap;
    display: flex;                          /* 垂直水平居中 */
    align-items: center;
    justify-content: center;
    text-align: center;
    box-shadow: none !important;
    flex-direction: column;                 /* 两行布局 */
}

.location:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4) !important;
}

/* 地点标签内部两行样式 */
.location .location-label-text {
    line-height: 1.1;
    color: #ffffff !important;
    /* 更清晰的黑色描边：无模糊的八向阴影 + webkit描边（自适应粗细） */
    text-shadow:
        1px 0 0 #000,
       -1px 0 0 #000,
        0 1px 0 #000,
        0 -1px 0 #000,
        1px 1px 0 #000,
       -1px 1px 0 #000,
        1px -1px 0 #000,
       -1px -1px 0 #000;
    -webkit-text-stroke: clamp(0.6px, 0.11vw, 1.2px) #000;
}

@media (max-width: 600px) {
	/* 移动端进一步减小描边，仅保留四向阴影，提升清晰度 */
	.location .location-label-text {
		text-shadow:
			0.35px 0 0 #000,
			-0.35px 0 0 #000,
			0 0.35px 0 #000,
			0 -0.35px 0 #000;
		-webkit-text-stroke: 0.2px #000;
	}
}

/* 高分屏手机上进一步瘦身描边，避免次像素模糊 */
@media (max-width: 600px) and (min-resolution: 2dppx) {
	.location .location-label-text {
		text-shadow:
			0.25px 0 0 #000,
			-0.25px 0 0 #000,
			0 0.25px 0 #000,
			0 -0.25px 0 #000;
		-webkit-text-stroke: 0 #000;
	}
}

.location .location-label-divider {
    width: 100%;
    height: 0;
    border-top: 2px solid rgba(255,255,255,0.75);
    margin: clamp(3px, 0.6vw, 6px) 0;      /* 两行之间的间距 */
    box-shadow: 0 0 4px rgba(255,255,255,0.5);
}

.location .location-people {
    line-height: 1;
    display: inline-flex;
    gap: clamp(2px, 0.4vw, 4px);
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
}

/* 手机端：以白色光点显示人数 */
@media (max-width: 600px) {
	.location .location-people .people-dot {
		width: 8px;
		height: 8px;
		border-radius: 50%;
		background: #fff;
		box-shadow: 0 0 4px rgba(255,255,255,0.85);
	}
	.location .location-label-divider {
		border-top-width: 1px;
		border-top-color: rgba(255,255,255,0.85);
		box-shadow: 0 0 6px rgba(255,255,255,0.6);
	}
}

@media (max-width: 600px) and (min-resolution: 2dppx) {
	.location .location-people .people-dot {
		width: 6px;
		height: 6px;
		box-shadow: 0 0 2px rgba(255,255,255,0.85);
	}
}

/* PC/平板通用光点尺寸（可与字体自适应）*/
.location .location-people .people-dot {
	width: clamp(6px, 0.9vw, 12px);
	height: clamp(6px, 0.9vw, 12px);
	border-radius: 50%;
	background: #fff;
	box-shadow: 0 0 4px rgba(255,255,255,0.85);
}

/* 竖屏手机：提高高度（更小的宽高比） */
@media (max-width: 600px) and (orientation: portrait) {
    .location {
        aspect-ratio: 1.5;  /* PC/平板 2.5 → 竖屏手机 1.5 */
    }
}

/* 普通模式（GameMode=0）：门派地图的地名标签边框与底色透明，保留文字样式 */
/* body:not(.slg-global) #map-scene .location {
    background: transparent !important;
    border-color: transparent !important;
    box-shadow: none !important;
} */


/* 空状态提示 */
.trading-empty {
    text-align: center;
    color: #999;
    padding: 40px 20px;
}

#shop-detail-modal {
    z-index: 3500; /* 确保在交易弹窗(2500)之上 */
}

.shop-detail-content {
    max-width: 350px;  /* 稍微增大一点，从400px改为350px */
    max-height: 60vh;  /* 限制高度 */
    padding: 20px;
    overflow-y: auto;
}

.shop-item-description {
    font-size: 14px;
    color: #666;
    margin: 15px 0;
    line-height: 1.6;
}

.shop-item-info {
    background: #f5f5f5;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.shop-item-stat {
    font-size: 13px;
    margin: 5px 0;
}

.shop-item-stat-label {
    font-weight: bold;
    color: #666;
}

.shop-item-price-info {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    padding: 10px;
    background: #e8f8f7;
    border-radius: 8px;
}

.price-label {
    font-size: 16px;
    font-weight: bold;
    color: #333;
}

.price-value {
    font-size: 18px;
    font-weight: bold;
    color: #4ecdc4;
}

/* 农场游戏iframe弹窗 */
.farm-modal {
    display: none;
    position: absolute;
    z-index: 3000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
}

.farm-container {
    width: 100%;
    height: 100%;
    margin: 0;
    position: relative;
}

.farm-iframe {
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 10px;
}

.slg-emotion-layer img {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    height: 85%;
    width: auto;
    max-width: 90%;              /* 可选：防止极端宽图超出 */
    object-fit: contain;         /* 覆盖全局的 cover */
    object-position: bottom center;
  }

  /* 汗青集正文字号与故事正文一致 */
#history-summary-content {
    font-size: clamp(0.9rem, 2.2vw, 1.125rem);
    line-height: 1.8;
}

/* 汗青集弹窗：允许遮罩本身滚动；内容填满遮罩 */
#history-summary-modal.modal.viewport-overlay {
    overflow: auto;   /* 覆盖通用的 overflow: hidden，仅此弹窗生效 */
}

#history-summary-modal .modal-content {
    height: 100% !important;
    max-height: none !important;
}